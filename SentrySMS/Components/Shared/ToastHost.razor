@implements IDisposable
@inject ToastService ToastService

<div class="toast-container">
    @foreach (var toast in _toasts)
    {
        <div class="toast toast-@toast.Level.ToString().ToLowerInvariant()">
            <div class="toast-title">@toast.Title</div>
            <div class="toast-message">@toast.Message</div>
        </div>
    }
</div>

@code {
    private readonly List<ToastMessage> _toasts = new();
    private readonly TimeSpan _timeout = TimeSpan.FromSeconds(4);

    protected override void OnInitialized()
    {
        ToastService.OnToast += HandleToast;
    }

    private void HandleToast(ToastMessage message)
    {
        _toasts.Add(message);
        _ = Task.Delay(_timeout).ContinueWith(_ =>
        {
            _toasts.Remove(message);
            InvokeAsync(StateHasChanged);
        });
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        ToastService.OnToast -= HandleToast;
    }
}
